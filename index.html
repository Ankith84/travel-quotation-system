<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamScape Journey - Quotation Automation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header h2 {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.8;
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
            gap: 1rem;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .step.active {
            background: rgba(255, 255, 255, 1);
            color: #667eea;
        }

        .step.inactive {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .upload-zone {
            border: 2px dashed #ccc;
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        .upload-zone:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .upload-zone.dragover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            opacity: 0.6;
        }

        .file-input {
            display: none;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .markup-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            margin: 1rem 0;
        }

        .quotation-preview {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            margin: 2rem 0;
        }

        .quote-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .company-info h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .company-info p {
            opacity: 0.9;
        }

        .quote-date {
            text-align: right;
        }

        .quote-body {
            padding: 2rem;
        }

        .trip-overview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .overview-card {
            padding: 2rem;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9ff, #e8f0fe);
        }

        .cost-card {
            background: linear-gradient(135deg, #f0fff4, #e6fffa);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .itinerary-day {
            border-left: 4px solid #667eea;
            padding-left: 1.5rem;
            margin-bottom: 2rem;
            background: #f8f9ff;
            border-radius: 0 15px 15px 0;
            padding: 1.5rem;
        }

        .day-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
        }

        .activity-list {
            list-style: none;
            padding: 0;
        }

        .activity-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
            color: #555;
        }

        .activity-bullet {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            margin-right: 1rem;
        }

        .hotel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .hotel-card {
            padding: 1.5rem;
            border-radius: 15px;
            background: linear-gradient(135deg, #fff8f0, #ffedd5);
        }

        .inclusions-exclusions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .list-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            color: #555;
        }

        .check-icon, .cross-icon {
            width: 16px;
            height: 16px;
            margin-right: 0.75rem;
            margin-top: 0.25rem;
        }

        .check-icon {
            color: #22c55e;
        }

        .cross-icon {
            color: #ef4444;
        }

        .policies-section {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .contact-footer {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-message {
            background: #22c55e;
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin: 2rem 0;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .trip-overview,
            .inclusions-exclusions,
            .contact-footer {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .progress-steps {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>DreamScape Journey</h1>
            <h2>Quotation Automation System</h2>
            <p>Transform DMC quotations into professional travel packages</p>
        </div>

        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="step active" id="step1">
                <span>üì§</span>
                <span>Upload & Configure</span>
            </div>
            <div class="step inactive" id="step2">
                <span>‚öôÔ∏è</span>
                <span>Review & Adjust</span>
            </div>
            <div class="step inactive" id="step3">
                <span>üì•</span>
                <span>Generate PDF</span>
            </div>
        </div>

        <!-- Step 1: Upload Section -->
        <div id="uploadSection" class="upload-section">
            <!-- Company Logo Upload -->
            <h3>Company Logo</h3>
            <div class="upload-zone" onclick="document.getElementById('logoInput').click()">
                <div class="upload-icon">üñºÔ∏è</div>
                <p>Click to upload your company logo</p>
                <input type="file" id="logoInput" class="file-input" accept="image/*">
            </div>
            <div id="logoPreview" style="text-align: center; margin-top: 1rem;"></div>

            <br><br>

            <!-- DMC File Upload -->
            <h3>Upload DMC Quotation</h3>
            <div class="upload-zone" id="fileUploadZone" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÑ</div>
                <p>Drop your DMC quotation here or click to browse</p>
                <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">Supports PDF, Word documents, and Text files</p>
                <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx,.txt">
            </div>
            <div id="fileStatus" style="margin-top: 1rem;"></div>

            <br><br>

            <!-- Markup Settings -->
            <h3>Markup Configuration</h3>
            <label for="markupSlider">Markup Percentage: <span id="markupValue">15</span>%</label>
            <input type="range" id="markupSlider" class="markup-slider" min="5" max="50" value="15">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #666;">
                <span>5%</span>
                <span>50%</span>
            </div>

            <div id="loadingSection" class="loading hidden">
                <div class="spinner"></div>
                <p>Processing your quotation...</p>
            </div>
        </div>

        <!-- Step 2: Preview Section -->
        <div id="previewSection" class="hidden">
            <div class="quotation-preview" id="quotationContent">
                <!-- Quotation content will be generated here -->
            </div>
            <div style="text-align: center; margin: 2rem 0; gap: 1rem; display: flex; justify-content: center;">
                <button class="btn btn-secondary" onclick="goToStep(1)">
                    <span>‚öôÔ∏è</span> Adjust Settings
                </button>
                <button class="btn btn-primary" onclick="generatePDF()">
                    <span>üì•</span> Generate PDF
                </button>
            </div>
        </div>

        <!-- Step 3: Success Section -->
        <div id="successSection" class="hidden">
            <div class="success-message">
                <h2>‚úÖ Quotation Generated Successfully!</h2>
                <p>Your professional travel quotation has been created and downloaded.</p>
            </div>
            <div style="text-align: center; margin: 2rem 0; gap: 1rem; display: flex; justify-content: center;">
                <button class="btn btn-secondary" onclick="goToStep(2)">
                    <span>üëÅÔ∏è</span> Preview Again
                </button>
                <button class="btn btn-primary" onclick="goToStep(1)">
                    <span>üì§</span> New Quotation
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let extractedData = null;
        let companyLogo = null;
        let uploadedFile = null;

        // Company data - customize this
        const companyData = {
            name: "DreamScape Journey",
            tagline: "Creating Unforgettable Travel Experiences",
            address: "123 Travel Street, Hyderabad, Telangana 500001",
            phone: "+91 9876543210",
            email: "info@dreamscapejourney.com",
            website: "www.dreamscapejourney.com"
        };

        // Default policies
        const policies = {
            payment: [
                "25% advance payment required at the time of booking",
                "75% balance payment to be made 15 days before departure",
                "Full payment required for bookings made within 15 days of departure",
                "All payments are non-refundable and non-transferable"
            ],
            cancellation: [
                "More than 30 days: 10% of total cost",
                "15-30 days: 25% of total cost",
                "7-15 days: 50% of total cost",
                "Less than 7 days: 100% of total cost"
            ],
            terms: [
                "Prices are subject to availability and confirmation",
                "Package rates are per person on twin sharing basis",
                "Additional charges may apply for peak season travel",
                "Travel insurance is highly recommended"
            ]
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        function setupEventListeners() {
            // Logo upload
            document.getElementById('logoInput').addEventListener('change', handleLogoUpload);
            
            // File upload
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            
            // Drag and drop
            const uploadZone = document.getElementById('fileUploadZone');
            uploadZone.addEventListener('dragover', handleDragOver);
            uploadZone.addEventListener('drop', handleDrop);
            
            // Markup slider
            document.getElementById('markupSlider').addEventListener('input', function(e) {
                document.getElementById('markupValue').textContent = e.target.value;
            });
        }

        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    companyLogo = e.target.result;
                    document.getElementById('logoPreview').innerHTML = 
                        `<img src="${companyLogo}" alt="Company Logo" style="height: 80px; border-radius: 10px;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                handleFileUpload({ target: { files: files } });
            }
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            uploadedFile = file;
            showLoading();

            try {
                let extractedText = '';
                
                if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || 
                    file.name.toLowerCase().endsWith('.docx')) {
                    
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    extractedText = result.value;
                    
                } else if (file.type === 'text/plain' || file.name.toLowerCase().endsWith('.txt')) {
                    
                    const reader = new FileReader();
                    extractedText = await new Promise((resolve, reject) => {
                        reader.onload = (e) => resolve(e.target.result);
                        reader.onerror = reject;
                        reader.readAsText(file);
                    });
                    
                } else if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
                    
                    // For PDF files, we'll simulate extraction since proper PDF parsing requires backend
                    alert('PDF processing requires a backend server. For demo purposes, using sample data.');
                    extractedText = `
                        TOUR PACKAGE: Rajasthan Heritage Tour
                        DESTINATION: Rajasthan
                        DURATION: 8 Days 7 Nights
                        PAX: 4 Adults
                        
                        HOTELS:
                        Hotel: Heritage Haveli Jaipur
                        Hotel: Lake Palace Udaipur
                        Hotel: Desert Camp Jaisalmer
                        
                        INCLUSIONS:
                        - Accommodation on twin sharing basis
                        - Daily breakfast and dinner
                        - AC vehicle for all transfers and sightseeing
                        - Professional English speaking guide
                        - All monument entrance fees
                        - Camel safari in Jaisalmer
                        - Boat ride in Lake Pichola
                        - All applicable taxes
                        
                        EXCLUSIONS:
                        - Airfare / train fare
                        - Personal expenses and tips
                        - Travel insurance
                        - Lunch (unless specified)
                        - Camera fees at monuments
                        - Any services not mentioned in inclusions
                        
                        ITINERARY:
                        Day 1: Arrival in Jaipur
                        - Airport pickup and transfer to hotel
                        - Hotel check-in and rest
                        - Evening visit to local markets
                        - Overnight stay in Jaipur
                        
                        Day 2: Jaipur City Tour
                        - Visit Amber Fort and Palace
                        - City Palace and Jantar Mantar
                        - Hawa Mahal photo stop
                        - Local handicraft shopping
                        
                        Day 3: Jaipur to Jodhpur
                        - Drive to Jodhpur (5-6 hours)
                        - Check-in at hotel
                        - Visit Mehrangarh Fort
                        - Evening at Jaswant Thada
                        
                        Day 4: Jodhpur to Jaisalmer
                        - Drive to Jaisalmer (5 hours)
                        - Check-in at desert camp
                        - Camel safari at Sam sand dunes
                        - Cultural program and dinner
                        
                        Day 5: Jaisalmer Sightseeing
                        - Visit Jaisalmer Fort
                        - Patwon ki Haveli
                        - Nathmal ki Haveli
                        - Sunset at Gadisar Lake
                        
                        Day 6: Jaisalmer to Udaipur
                        - Drive to Udaipur (8 hours with lunch break)
                        - Check-in at lake view hotel
                        - Evening leisure
                        
                        Day 7: Udaipur City Tour
                        - City Palace complex
                        - Jagdish Temple
                        - Boat ride in Lake Pichola
                        - Visit Saheliyon ki Bari
                        
                        Day 8: Departure
                        - Hotel checkout
                        - Transfer to airport/railway station
                        - Tour ends with sweet memories
                        
                        TOTAL COST: Rs. 95,000
                    `;
                } else {
                    throw new Error('Please upload a PDF, Word document, or text file');
                }

                // Parse the extracted text
                extractedData = parseExtractedText(extractedText);
                
                hideLoading();
                goToStep(2);
                
            } catch (error) {
                console.error('Error processing file:', error);
                hideLoading();
                alert(`Error processing file: ${error.message}`);
            }
        }

        function parseExtractedText(text) {
            const lines = text.split('\n').filter(line => line.trim().length > 0);
            
            const parsedData = {
                destination: '',
                duration: '',
                pax: '',
                startDate: '',
                endDate: '',
                hotels: [],
                inclusions: [],
                exclusions: [],
                itinerary: [],
                baseCost: 0,
                costBreakdown: []
            };

            let currentSection = '';
            let currentDay = 0;

            lines.forEach((line) => {
                const lowerLine = line.toLowerCase();
                const trimmedLine = line.trim();

                // Extract destination
                if (!parsedData.destination) {
                    const destPatterns = [
                        /(?:destination|tour.*?to|package.*?for|trip.*?to)[:\s-]+([^,\n\r]+)/i,
                        /^([A-Za-z\s]+(?:tour|package|trip))/i,
                    ];
                    
                    for (const pattern of destPatterns) {
                        const match = trimmedLine.match(pattern);
                        if (match && match[1]) {
                            parsedData.destination = match[1].trim().replace(/tour|package|trip/gi, '').trim();
                            break;
                        }
                    }
                }

                // Extract duration
                if (!parsedData.duration) {
                    const durationMatch = trimmedLine.match(/(\d+)\s*(?:days?)\s*[\/&-]\s*(\d+)\s*(?:nights?)/i);
                    if (durationMatch) {
                        parsedData.duration = `${durationMatch[1]} Days ${durationMatch[2]} Nights`;
                    }
                }

                // Extract pax
                if (!parsedData.pax) {
                    const paxMatch = trimmedLine.match(/(\d+)\s*(?:adults?|pax|persons?)/i);
                    if (paxMatch) {
                        parsedData.pax = `${paxMatch[1]} Adults`;
                    }
                }

                // Extract cost
                const costMatch = trimmedLine.match(/(?:total|cost|price|amount)[:\s]*(?:rs\.?|‚Çπ|inr)?\s*(\d{1,2}(?:,\d{2,3})*)/i);
                if (costMatch) {
                    const cost = parseInt(costMatch[1].replace(/,/g, ''));
                    if (cost > 1000 && cost > parsedData.baseCost) {
                        parsedData.baseCost = cost;
                    }
                }

                // Extract hotels
                const hotelMatch = trimmedLine.match(/hotel[:\s]+([^,\n\r]+)/i);
                if (hotelMatch && hotelMatch[1]) {
                    const hotelName = hotelMatch[1].trim();
                    if (!parsedData.hotels.find(h => h.name === hotelName)) {
                        parsedData.hotels.push({
                            name: hotelName,
                            location: parsedData.destination || 'Location TBD',
                            nights: 2,
                            roomType: 'Standard Room'
                        });
                    }
                }

                // Detect sections
                if (lowerLine.includes('inclusion')) {
                    currentSection = 'inclusions';
                    return;
                }
                if (lowerLine.includes('exclusion')) {
                    currentSection = 'exclusions';
                    return;
                }
                if (lowerLine.includes('itinerary') || lowerLine.includes('day ')) {
                    currentSection = 'itinerary';
                    return;
                }

                // Add content to sections
                if (currentSection === 'inclusions' && (trimmedLine.startsWith('-') || trimmedLine.length > 10)) {
                    const content = trimmedLine.replace(/^[-‚Ä¢*]\s*/, '').trim();
                    if (content && !parsedData.inclusions.includes(content)) {
                        parsedData.inclusions.push(content);
                    }
                }

                if (currentSection === 'exclusions' && (trimmedLine.startsWith('-') || trimmedLine.length > 10)) {
                    const content = trimmedLine.replace(/^[-‚Ä¢*]\s*/, '').trim();
                    if (content && !parsedData.exclusions.includes(content)) {
                        parsedData.exclusions.push(content);
                    }
                }

                if (currentSection === 'itinerary') {
                    const dayMatch = trimmedLine.match(/day\s*(\d+)[:\s-]*(.+)/i);
                    if (dayMatch) {
                        currentDay = parseInt(dayMatch[1]);
                        const title = (dayMatch[2] || '').trim() || `Day ${currentDay}`;
                        parsedData.itinerary.push({
                            day: currentDay,
                            title: title,
                            activities: []
                        });
                    } else if (currentDay > 0 && trimmedLine.length > 5) {
                        const lastItinerary = parsedData.itinerary[parsedData.itinerary.length - 1];
                        if (lastItinerary) {
                            const activity = trimmedLine.replace(/^[-‚Ä¢*]\s*/, '').trim();
                            if (activity) lastItinerary.activities.push(activity);
                        }
                    }
                }
            });

            // Set defaults
            if (!parsedData.destination) parsedData.destination = "Travel Destination";
            if (!parsedData.duration) parsedData.duration = "5 Days 4 Nights";
            if (!parsedData.pax) parsedData.pax = "2 Adults";
            if (!parsedData.baseCost || parsedData.baseCost < 1000) parsedData.baseCost = 50000;

            // Generate dates
            const today = new Date();
            const startDate = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
            const duration = parseInt(parsedData.duration.match(/(\d+)/)[1]);
            const endDate = new Date(startDate.getTime() + (duration - 1) * 24 * 60 * 60 * 1000);
            
            parsedData.startDate = startDate.toISOString().split('T')[0];
            parsedData.endDate = endDate.toISOString().split('T')[0];

            // Set defaults if arrays are empty
            if (parsedData.hotels.length === 0) {
                parsedData.hotels.push({
                    name: `Premium Hotel - ${parsedData.destination}`,
                    location: parsedData.destination,
                    nights: Math.floor(duration/2),
                    roomType: 'Deluxe Room'
                });
            }

            if (parsedData.inclusions.length === 0) {
                parsedData.inclusions = [
                    `Accommodation in ${parsedData.destination}`,
                    'Daily breakfast',
                    'Airport transfers',
                    'Local sightseeing as per itinerary',
                    'All applicable taxes'
                ];
            }

            if (parsedData.exclusions.length === 0) {
                parsedData.exclusions = [
                    'Airfare (unless mentioned)',
                    'Personal expenses and tips',
                    'Travel insurance',
                    'Meals not mentioned in inclusions',
                    'Any services not specified in inclusions'
                ];
            }

            if (parsedData.itinerary.length === 0) {
                for (let i = 1; i <= duration; i++) {
                    if (i === 1) {
                        parsedData.itinerary.push({
                            day: i,
                            title: `Arrival in ${parsedData.destination}`,
                            activities: ['Airport pickup and transfer to hotel', 'Hotel check-in', 'Welcome briefing', 'Rest and leisure time']
                        });
                    } else if (i === duration) {
                        parsedData.itinerary.push({
                            day: i,
                            title: 'Departure',
                            activities: ['Hotel checkout', 'Last-minute shopping (if time permits)', 'Transfer to airport', 'Departure']
                        });
                    } else {
                        parsedData.itinerary.push({
                            day: i,
                            title: `Explore ${parsedData.destination}`,
                            activities: ['Breakfast at hotel', 'Full day sightseeing tour', 'Visit local attractions', 'Return to hotel']
                        });
                    }
                }
            }

            // Generate cost breakdown
            parsedData.costBreakdown = [
                { item: 'Accommodation', cost: Math.round(parsedData.baseCost * 0.35) },
                { item: 'Transportation', cost: Math.round(parsedData.baseCost * 0.25) },
                { item: 'Meals', cost: Math.round(parsedData.baseCost * 0.20) },
                { item: 'Activities & Sightseeing', cost: Math.round(parsedData.baseCost * 0.15) },
                { item: 'Taxes & Service Charges', cost: Math.round(parsedData.baseCost * 0.05) }
            ];

            return parsedData;
        }

        function showLoading() {
            document.getElementById('loadingSection').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingSection').classList.add('hidden');
        }

        function goToStep(step) {
            // Update step indicators
            document.querySelectorAll('.step').forEach((el, index) => {
                if (index + 1 <= step) {
                    el.classList.remove('inactive');
                    el.classList.add('active');
                } else {
                    el.classList.remove('active');
                    el.classList.add('inactive');
                }
            });

            // Show/hide sections
            document.getElementById('uploadSection').classList.toggle('hidden', step !== 1);
            document.getElementById('previewSection').classList.toggle('hidden', step !== 2);
            document.getElementById('successSection').classList.toggle('hidden', step !== 3);

            currentStep = step;

            if (step === 2 && extractedData) {
                renderQuotation();
            }
        }

        function calculateFinalCost() {
            const markupPercentage = parseInt(document.getElementById('markupSlider').value);
            return Math.round(extractedData.baseCost * (1 + markupPercentage / 100));
        }

        function renderQuotation() {
            if (!extractedData) return;

            const finalCost = calculateFinalCost();
            const markupAmount = finalCost - extractedData.baseCost;
            const markupPercentage = parseInt(document.getElementById('markupSlider').value);

            const quotationHTML = `
                <!-- Header -->
                <div class="quote-header">
                    <div class="company-info">
                        ${companyLogo ? `<img src="${companyLogo}" alt="Logo" style="height: 60px; margin-bottom: 1rem; border-radius: 10px;">` : ''}
                        <h1>${companyData.name}</h1>
                        <p>${companyData.tagline}</p>
                    </div>
                    <div class="quote-date">
                        <p style="opacity: 0.8;">Quotation Date</p>
                        <p style="font-weight: bold;">${new Date().toLocaleDateString()}</p>
                    </div>
                </div>

                <!-- Body -->
                <div class="quote-body">
                    <!-- Trip Overview -->
                    <div class="trip-overview">
                        <div class="overview-card">
                            <h2 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <span>üìç</span>
                                ${extractedData.destination}
                            </h2>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üìÖ</span>
                                    <span>${extractedData.duration}</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span>üë•</span>
                                    <span>${extractedData.pax}</span>
                                </div>
                                <div style="grid-column: 1 / -1; margin-top: 0.5rem;">
                                    <span style="color: #666;">Travel Dates: </span>
                                    <span style="font-weight: 600;">${extractedData.startDate} to ${extractedData.endDate}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overview-card cost-card">
                            <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                <span>üí∞</span>
                                Package Cost
                            </h3>
                            <div style="font-size: 2rem; font-weight: bold; color: #22c55e; margin-bottom: 0.5rem;">
                                ‚Çπ${finalCost.toLocaleString()}
                            </div>
                            <p style="font-size: 0.9rem; color: #666;">Per person on twin sharing basis</p>
                            <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #888;">
                                Base cost: ‚Çπ${extractedData.baseCost.toLocaleString()} + Markup (${markupPercentage}%): ‚Çπ${markupAmount.toLocaleString()}
                            </div>
                        </div>
                    </div>

                    <!-- Itinerary -->
                    <div class="section-title">
                        <span>üìÖ</span>
                        Detailed Itinerary
                    </div>
                    <div style="margin-bottom: 3rem;">
                        ${extractedData.itinerary.map(day => `
                            <div class="itinerary-day">
                                <div class="day-title">Day ${day.day}: ${day.title}</div>
                                <ul class="activity-list">
                                    ${day.activities.map(activity => `
                                        <li class="activity-item">
                                            <div class="activity-bullet"></div>
                                            ${activity}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Hotels -->
                    <div class="section-title">
                        <span>üè®</span>
                        Accommodation
                    </div>
                    <div class="hotel-grid">
                        ${extractedData.hotels.map(hotel => `
                            <div class="hotel-card">
                                <h4 style="font-weight: bold; margin-bottom: 0.5rem;">${hotel.name}</h4>
                                <p style="color: #666; margin-bottom: 1rem;">${hotel.location}</p>
                                <div style="font-size: 0.9rem;">
                                    <span style="background: #fff2e5; color: #d97706; padding: 0.25rem 0.75rem; border-radius: 15px;">
                                        ${hotel.nights} nights ‚Ä¢ ${hotel.roomType}
                                    </span>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Inclusions & Exclusions -->
                    <div class="inclusions-exclusions">
                        <div>
                            <div class="section-title" style="color: #22c55e;">
                                <span>‚úÖ</span>
                                Package Inclusions
                            </div>
                            ${extractedData.inclusions.map(item => `
                                <div class="list-item">
                                    <span class="check-icon">‚úì</span>
                                    <span>${item}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div>
                            <div class="section-title" style="color: #ef4444;">
                                <span>‚ùå</span>
                                Package Exclusions
                            </div>
                            ${extractedData.exclusions.map(item => `
                                <div class="list-item">
                                    <span class="cross-icon">‚äó</span>
                                    <span>${item}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Policies -->
                    <div class="policies-section">
                        <div class="section-title">
                            <span>üìã</span>
                            Terms & Conditions
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                            <div>
                                <h4 style="font-weight: bold; color: #667eea; margin-bottom: 1rem;">Payment Policy</h4>
                                ${policies.payment.map(item => `<div style="margin-bottom: 0.5rem; font-size: 0.9rem;">‚Ä¢ ${item}</div>`).join('')}
                            </div>
                            
                            <div>
                                <h4 style="font-weight: bold; color: #ef4444; margin-bottom: 1rem;">Cancellation Policy</h4>
                                ${policies.cancellation.map(item => `<div style="margin-bottom: 0.5rem; font-size: 0.9rem;">‚Ä¢ ${item}</div>`).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="font-weight: bold; color: #666; margin-bottom: 1rem;">Important Terms</h4>
                            ${policies.terms.map(item => `<div style="margin-bottom: 0.5rem; font-size: 0.9rem;">‚Ä¢ ${item}</div>`).join('')}
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="contact-footer">
                        <div>
                            <h3 style="margin-bottom: 1rem;">Contact Information</h3>
                            <p><strong>Address:</strong> ${companyData.address}</p>
                            <p><strong>Phone:</strong> ${companyData.phone}</p>
                        </div>
                        <div>
                            <div style="height: 1rem;"></div>
                            <p><strong>Email:</strong> ${companyData.email}</p>
                            <p><strong>Website:</strong> ${companyData.website}</p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('quotationContent').innerHTML = quotationHTML;
        }

        async function generatePDF() {
            try {
                // Show loading
                const originalText = event.target.innerHTML;
                event.target.innerHTML = '<span>‚è≥</span> Generating PDF...';
                event.target.disabled = true;

                // Use html2canvas to capture the quotation
                const element = document.getElementById('quotationContent');
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: false
                });

                // Create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 295; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                // Add more pages if needed
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                // Save the PDF
                const fileName = `${companyData.name}_${extractedData.destination}_Quotation_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);

                // Restore button
                event.target.innerHTML = originalText;
                event.target.disabled = false;

                // Go to success step
                setTimeout(() => {
                    goToStep(3);
                }, 1000);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
                
                // Restore button
                event.target.innerHTML = originalText;
                event.target.disabled = false;
            }
        }
    </script>
</body>
</html>
